%% Dicode Channel Information Rate (Markov Input)
clear all;close all;clc;
Input_Size = 1e4 ;
MeanIter=5;
cnTime  = 1 ;
SNRdBInterval=(4.5);
FrequencyResponse=[1 -1];
ISI_Length=length(FrequencyResponse)-1;

Trans_Pr=Uniform_Trellis_Generator(power(2,ISI_Length));
%%                                          ===========
%  =========================================DICODE/EPR4=======================================================
%                                           ===========
% Trans_Pr=[6.85697285217096e-09,0.999999993143027,0,0,0,0,0,0; % *Optimal  Distribution  
%           0,0,0.999999999374000,6.26001739270861e-10,0,0,0,0; % IUD SecureRATE:0.16897
%           0,0,0,0,0.3746236209206790,0.62537637907932000,0,0; % =====================
%           0,0,0,0,0,0,0.7633433183332820,0.23665668166671900; % Main Channel    
%           0.20178080229423600,0.7982191977057630,0,0,0,0,0,0; % DICODE/SNR:2.5dB/Rate:0.54475
%           0,0,0.6436482187675900,0.35635178123241100,0,0,0,0; % =================SecCapacity=0.26553
%           0,0,0,0,1.59053481486106e-09,0.999999998409468,0,0; % Eave Channel    
%           0,0,0,0,0,0,0.999999944664568,5.53354322003597e-08];% EPR4 / SNR:0.5db/Rate:0.27922
% =================================================================================================
% Trans_Pr=[3.42492173106893e-12,0.999999999996576,0,0,0,0,0,0; % *Optimal  Distribution  
%           0,0,1.000000000000000,5.16378246176113e-16,0,0,0,0; % IUD SecureRATE:0.0312
%           0,0,0,0,0.2868480777534230,0.71315192224657900,0,0; % =====================
%           0,0,0,0,0,0,0.9552596316049110,0.04474036839509240; % Main Channel    
%           0.05699667150233460,0.9430033284976720,0,0,0,0,0,0; % DICODE/SNR:3.9dB/Rate:0.5313
%           0,0,0.7202739882269960,0.27972601177301000,0,0,0,0; % =================SecCapacity=0.12394
%           0,0,0,0,2.42436289084456e-17,1.000000000000010,0,0; % Eave Channel    
%           0,0,0,0,0,0,0.999999990501301,9.49870001467273e-09];% EPR4 / SNR:3.9db/Rate:0.40736
% =================================================================================================
% Trans_Pr=[1.13775630803525e-12,0.999999999998861,0,0,0,0,0,0; % *Optimal  Distribution  
%           0,0,0.999999999999994,1.53618694432476e-16,0,0,0,0; % IUD SecureRATE:0.015585
%           0,0,0,0,0.2637910584704060,0.73620894152958100,0,0; % =====================
%           0,0,0,0,0,0,0.9564558460798810,0.04354415392011130; % Main Channel    
%           0.06924640622025650,0.9307535937797390,0,0,0,0,0,0; % DICODE/SNR:3.8dB/Rate:0.5237
%           0,0,0.72123682916056200,0.2787631708394320,0,0,0,0; % =================SecCapacity=0.12265
%           0,0,0,0,7.64180729032625e-18,0.999999999999994,0,0; % Eave Channel    
%           0,0,0,0,0,0,0.999999349030187,6.50969811655496e-07];% EPR4 / SNR:4.0db/Rate:0.40105
% =================================================================================================
Trans_Pr=[6.24294484653761e-15,0.999999999999994,0,0,0,0,0,0; % *Optimal  Distribution
          0,0,1.000000000000000,2.53077154361432e-17,0,0,0,0; % IUD SecureRATE:0
          0,0,0,0,0.2575707369434630,0.74242926305651600,0,0; % =====================
          0,0,0,0,0,0,0.9582237594585360,0.04177624054146140; % Main Channel
          0.07734758551340160,0.9226524144865960,0,0,0,0,0,0; % DICODE/SNR:4.5dB/Rate:0.54613
          0,0,0.7588218629485850,0.24117813705141300,0,0,0,0; % =================SecCapacity=0.07176
          0,0,0,0,2.07953761338816e-17,0.999999999999997,0,0; % Eave Channel
          0,0,0,0,0,0,1.000000000000000,5.87869251156965e-16];% EPR4 / SNR:5.5db/Rate:0.47437

%%                                          ===========
%  =========================================EPR4/DICODE=======================================================
%                                           ===========
% Trans_Pr=[0.6624906588911920,0.33750934110880800,0,0,0,0,0,0; % *Optimal  Distribution
%           0,0,1.29680593561866e-08,0.999999987031941,0,0,0,0; % IUD SecureRATE:0.12206
%           0,0,0,0,0.1626857340163720,0.83731426598362800,0,0; % =====================
%           0,0,0,0,0,0,0.21493310566865600,0.7850668943313450; % Main Channel
%           0.77768359273433200,0.2223164072656690,0,0,0,0,0,0; % EPR4 / SNR:3.3dB/Rate:0.56432
%           0,0,5.01668841997957e-05,0.999949833115799,0,0,0,0; % =================SecCapacity=0.24115
%           0,0,0,0,0.999974231639635,2.57683603656156e-05,0,0; % Eave Channel
%           0,0,0,0,0,0,0.3383159674097810,0.6616840325902180]; % DICODE/SNR:1.3db/Rate:0.32317
% =================================================================================================
% Trans_Pr=[0.6675772049887820,0.33242279501122200,0,0,0,0,0,0; % *Optimal  Distribution
%           0,0,6.10917862578452e-06,0.999993890821375,0,0,0,0; % IUD SecureRATE:0.12206
%           0,0,0,0,0.999999999988673,1.13317590269809e-11,0,0; % =====================
%           0,0,0,0,0,0,0.19545090525689200,0.8045490947431120; % Main Channel
%           0.7721774085076660,0.22782259149233600,0,0,0,0,0,0; % EPR4 / SNR:3.3dB/Rate:0.56454
%           0,0,1.94243563851047e-11,0.999999999980577,0,0,0,0; % =================SecCapacity=0.24212
%           0,0,0,0,0.999996002243882,3.99775612138737e-06,0,0; % Eave Channel
%           0,0,0,0,0,0,0.3539497862467100,0.6460502137532920]; % DICODE/SNR:1.3db/Rate:0.32242
% =================================================================================================
% Trans_Pr=[0.63308073051280600,0.3669192694871950,0,0,0,0,0,0; % *Optimal  Distribution
%           0,0,5.75797518613983e-08,0.999999942420247,0,0,0,0; % IUD SecureRATE:0
%           0,0,0,0,0.9989016437508420,0.00109835624915916,0,0; % =====================
%           0,0,0,0,0,0,0.04976785493014000,0.9502321450698620; % Main Channel
%           0.9219180797489210,0.07808192025107920,0,0,0,0,0,0; % EPR4 / SNR:1.8dB/Rate:0.44985
%           0,0,0.00475660637735046,0.9952433936226490,0,0,0,0; % =================SecCapacity=0.13745
%           0,0,0,0,0.999999974719147,2.52808532095942e-08,0,0; % Eave Channel
%           0,0,0,0,0,0,0.36304024549978100,0.636959754500220]; % DICODE/SNR:1.5db/Rate:0.3124
% ============================================================================================================
% Trans_Pr=[0.7949046588700830,0.20509534112991700,0,0,0,0,0,0; % *Optimal  Distribution
%           0,0,2.59279556391607e-17,1.000000000000000,0,0,0,0; % IUD SecureRATE:0
%           0,0,0,0,0.9924959011427980,0.00750409885720290,0,0; % =====================
%           0,0,0,0,0,0,0.9891882874643100,0.01081171253568930; % Main Channel
%           0.9787487927362570,0.02125120726374670,0,0,0,0,0,0; % EPR4 / SNR:7.8dB/Rate:0.46487
%           0,0,0.999986009668276,1.39903317272975e-05,0,0,0,0; % =================SecCapacity=0.01102
%           0,0,0,0,0.9069701011594530,0.09302989884055030,0,0; % Eave Channel
%           0,0,0,0,0,0,0.4370731701914100,0.5629268298086010]; % DICODE/SNR:8.2db/Rate:0.45376

%%                                         =============
%  ========================================DICODE/DICODE========================================================
%                                          =============
% Trans_Pr=[0.465457455818251,0.534542544181749;
%          0.536327667698690,0.463672332301310];
     % *Optimal  Distribution
     % IUD SecureRATE:0.14702
     % =====================
     % Main Channel
     % DICODE/SNR:0.5dB/Rate:0.48525
     % =================SecCapacity=0.14731
     % Eave Channel
     % DICODE/SNR:2.5db/Rate:0.63256
     %==============================
% ============================================================================================================
 %%

FrequencyResponse=FrequencyResponse./sqrt(sum(FrequencyResponse.^2));
Trans = PR_Trellis( FrequencyResponse );
Trans = jSourceChannel( Trans , Trans_Pr );
format long
Capacity_iid=zeros(size(SNRdBInterval));
C_acc=zeros(1,MeanIter);
for SNRdB=SNRdBInterval
VarEyAns=10^(-SNRdB/10);
    for mIndex=1:MeanIter
        C_acc(mIndex)=C_iid( Input_Size , VarEyAns , Trans , Trans_Pr );
        disp(['Capacity Sim','(',num2str(mIndex),') :',num2str(C_acc(mIndex))]);
        symbline(length(['Capacity Sim','(',mIndex,') :',num2str(C_acc(mIndex))]),'-');
    end
  Capacity_iid(cnTime) = mean(C_acc);
  disp(['SNRdB: ',num2str(SNRdB),' | Capacity Avg: ',num2str(Capacity_iid(cnTime))]);
  symbline(length(['SNRdB: ',num2str(SNRdB),' | Capacity Avg: ',num2str(Capacity_iid(cnTime))]),'=');
cnTime= cnTime + 1 ; 
end
% save;
% SecrecySurf;
% plot( SNRdBInterval , Capacity_iid , 'color' , 'b' , 'LineWidth',1, 'Marker','*' ,'MarkerEdgeColor','r');xlabel('SNR [db]');ylabel('Capacity [bits/channel-use]')